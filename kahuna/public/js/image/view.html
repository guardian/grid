<div class="full-image" ng:controller="ImageCtrl">
    <div class="image-details" id="image-info">
        <dl class="image-info image-info--main">
            <dt class="image-info__heading image-info__heading--first">Labels</dt>
            <dd>
                <ui-labeller labels="image.data.userMetadata.data.labels">
                </ui-labeller>
            </dd>

            <dt class="image-info__heading">Description</dt>
            <dd>{{image.data.metadata.description}}</dd>

            <dt class="image-info__heading">Uploaded</dt>
            <dd>{{image.data.uploadTime | date:'d MMM yyyy, HH:mm'}}</dd>
        </dl>

        <div class="image-info image-info--sub">
            <table class="image-info__group metadata">
                <caption class="metadata__heading">Metadata</caption>
                <tbody class="metadata__body">
                    <tr ng:repeat="(key, value) in image.data.metadata" ng:if="isUsefulMetadata(key)">
                        <th class="metadata__key">{{key}}</td>
                        <td>{{value}}</td>
                    </tr>
                </tbody>
            </table>

            <dl class="image-info__group" ng:if="crops.length > 0">
                <dt class="image-info__heading">Crops <span ng:if="cropKey">(<a ui:sref="{ crop: null }">original</a>)</span></dt>
                <dd>
                    <ul class="image-crops">
                        <li class="image-crop"
                            ng:class="{'image-crop--selected': crop.id == cropKey}"
                            ng:repeat="crop in crops">
                            <a draggable="true"
                               ng:init="extremeAssets = (crop | getExtremeAssets)"
                               ui:sref="{crop: crop.id}"
                               ui:drag-data="{{imageSync | asImageAndCropsDragData:crop}}"
                               ui:drag-image="{{extremeAssets.smallest | assetFile}}">
                                <img class="image-crop__image" ng:src="{{extremeAssets.smallest | assetFile}}" />
                            </a>
                            <div class="image-crop__aspect-ratio">{{crop.specification.aspectRatio | asAspectRatioWord}}</div>
                        </li>
                    </ul>
                </dd>
            </dl>

            <dl class="image-info__group" ng:if="image.data.metadata.keywords.length > 0">
                <dt class="image-info__heading">Keywords</dt>
                <dd>
                    <ul>
                        <li class="image-info__keyword"
                            ng:repeat="keyword in image.data.metadata.keywords">
                            {{keyword}}
                        </li>
                    </ul>
                </dd>
            </dl>
        </div>
    </div>
    <div class="image-holder">
        <div class="top-bar-wrapper">
            <div class="top-bar top-bar--dark">
                <div class="top-bar__nav">
                    <a class="top-bar__item top-bar__item--first"
                       ui:sref="search.results">← search</a>
                    <a class="top-bar__item top-bar__item"
                       ng:if="cropKey"
                       ui:sref="{ crop: null }">← original</a>
                </div>

                <div class="top-bar__items">
                    <ui-archiver class="top-bar__item"
                                 ng:if="image.data"
                                 archived="image.data.userMetadata.data.archived"></ui-archiver>

                    <a class="top-bar__item"
                       ui:sref="crop({imageId: image.data.id})">
                       ✄ <span ng:if="cropKey">re</span>crop
                    </a>
                </div>
            </div>
        </div>

        <div class="easel">
            <div class="easel__canvas" ng:if="!cropKey && image.data">
                <img class="easel__image"
                     ng:src="{{image.data.source | assetFile}}"
                     ui:drag-data="{{imageSync | asImageDragData}}" />
            </div>


            <!-- TODO: As this loads async, add a loader -->
            <div class="easel__canvas" ng:if="cropKey">
                <a draggable="true"
                   class="easel__image-container"
                   ng:if="crop"
                   ng:init="extremeAssets = (crop | getExtremeAssets)"
                   ui:sref="{crop: cropKey}"
                   ui:drag-data="{{imageSync | asImageAndCropsDragData:crop}}"
                   ui:drag-image="{{extremeAssets.smallest | assetFile}}">
                    <img class="easel__image" ng:src="{{extremeAssets.largest | assetFile}}" />
                </a>
            </div>
        </div>
    </div>
</div>
