<!-- TODO: show only after a delay -->
<div ng:if="ctrl.loading"
     class="image-loading-results">
    Fetching images…
</div>

<div ng:if="! ctrl.loading"
    ng:class="{'results--left': ctrl.inSelectionMode()}">
    <div ng:show="ctrl.images.length == 0"
         class="image-no-results">
        No matches, sorry!
    </div>

    <div ng:show="ctrl.images.length > 0">

        <div class="image-results-count">
            {{ctrl.totalResults | toLocaleString}} matches
            <span ng:if="ctrl.inSelectionMode()">({{ctrl.selectedImages.size}} selected)</span>
            <button ng:show="ctrl.newImagesCount > 0"
                    ng:click="ctrl.revealNewImages()"
                    class="image-results-count__new">
                {{ctrl.newImagesCount | toLocaleString}} new
            </button>
        </div>

        <ul class="results"
            ui:has-space="ctrl.uiHasSpace"
            ui:near-bottom="ctrl.whenNearBottom()"
            ui:forget-window-scroll="ctrl.searched"
            ui:window-resized="ctrl.fillRemainingSpace()">
            <li class="result"
                ng:repeat="image in ctrl.images"
                ng:class="{ 'result--seen': ctrl.imageHasBeenSeen(image), 'result--selected': ctrl.imageHasBeenSelected(image)}">

                <!-- <HACK> -->
                <!-- We don't want to add a property on `image` to determine the state of the checkbox, so render two individual inputs. -->
                <!-- </HACK> -->
                <div class="result__select result__select--selected" ng:if="ctrl.imageHasBeenSelected(image)">
                    <input type="checkbox"
                           class="result__select__checkbox"
                           id="{{image.data.id}}-result__select__checkbox--select"
                           checked="true"
                           ng:click="ctrl.toggleSelection(image, false)"/>
                    <label for="{{image.data.id}}-result__select__checkbox--select"
                           class="result__select__checkbox__label">
                        <gr-icon>check_box</gr-icon>
                    </label>
                </div>

                <div class="result__select" ng:if="!ctrl.imageHasBeenSelected(image)">
                    <input type="checkbox"
                           class="result__select__checkbox"
                           id="{{image.data.id}}-result__select__checkbox--deselect"
                           ng:click="ctrl.toggleSelection(image, true)" />
                    <label for="{{image.data.id}}-result__select__checkbox--deselect"
                           class="result__select__checkbox__label">
                        <gr-icon>check_box</gr-icon>
                    </label>
                </div>

                <ui-preview-image image="image" selection-mode="ctrl.inSelectionMode()"
                    ng:class="{'preview__quick-select': ctrl.inSelectionMode()}"
                    ng:click="ctrl.onImageClick(image, $event)">
                    <button class="mark-as-seen image-action"
                            title="Mark all images until this point as seen"
                            ui:localstore="search.seenFrom"
                            ui:localstore-val="ctrl.getLastSeenVal(image)">☑</button>
                </ui-preview-image>
            </li>
        </ul>
    </div>
</div>
