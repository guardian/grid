<div ng:init="node = ctrl.node" class="hover-parent">
    <div class="node__info flex-container"
         ng:class="{'node__info--selected' : ctrl.isSelected}"
         gr:drop-into-collection="node.data.fullPath">

        <div class="node__marker"
             style="background: {{node.data.cssColour}}"></div>

        <div class="node__spacer" ng:if="node.data.children.length === 0">
            <gr-icon></gr-icon>
        </div>

        <button type="button"
                class="node__toggler clickable"
                ng:click="ctrl.showChildren = !ctrl.showChildren"
                ng:show="node.data.children.length > 0">

            <gr-icon ng:show="ctrl.showChildren">expand_more</gr-icon>
            <gr-icon ng:hide="ctrl.showChildren">chevron_right</gr-icon>
        </button>

        <a class="node__name flex-spacer"
           ui:sref="search.results({query: ctrl.getCollectionQuery(node.data.data.pathId)})">
            {{node.data.data.description}}
        </a>


        <button class="node__action clickable" type="button"
                title="Delete this collection"
                ng:if="ctrl.deletable && ctrl.editing"
                ng:click="ctrl.remove()">
            <gr-icon-label gr-icon="delete"></gr-icon-label>
        </button>

        <button class="node__action clickable"
                type="button"
                title="Add a new sub-collection"
                ng:if="ctrl.editing"
                ng:click="$parent.active = !$parent.active">
            <gr-icon>add_box</gr-icon>
        </button>

        <div class="text-small flex-container flex-center"
             ng:if="ctrl.saving || dropIntoCollectionSaving">Adding…</div>

        <button class="node__action clickable hover-child"
                title="Add selected images to this collection"
                ng:if="!ctrl.editing && ctrl.hasImagesSelected && !ctrl.saving"
                ng:click="ctrl.addImagesToCollection()">
            <gr-icon>add_to_photos</gr-icon>
        </button>
    </div>

    <form class="node__add-child" ng:if="active" ng:submit="ctrl.addChild(childName);">
        <input class="node__add-child-input" type="text" required ng:model="childName"
               placeholder="e.g. summer2015…" />

        <div class="error error--small" ng:if="formError">{{formError}}</div>

        <div class="node__add-child-buttons">
            <button type="submit" class="button-save" title="Save">
                <gr-icon-label gr-icon="check"></gr-icon-label>
            </button>
            <button type="button" class="button-cancel" ng:click="clearForm()" title="Cancel">
                <gr-icon-label gr-icon="close"></gr-icon-label>
            </button>
        </div>

    </form>

    <div class="node__children"></div>
</div>
