<div class="full-image" ng:controller="ImageCtrl">
    <div class="image-details" id="image-info">
        <dl class="image-info">
            <dt class="image-info__heading image-info__heading--first">Description</dt>
            <dd>{{image.data.metadata.description}}</dd>

            <dt class="image-info__heading">Uploaded</dt>
            <dd>{{image.data.uploadTime | date:'d MMM yyyy, HH:mm'}}</dd>
        </dl>

        <table class="metadata">
            <caption class="metadata__heading">Metadata</caption>
            <tbody class="metadata__body">
                <tr ng:repeat="(key, value) in image.data.metadata" ng:if="isUsefulMetadata(key)">
                    <th class="metadata__key">{{key}}</td>
                    <td>{{value}}</td>
                </tr>
            </tbody>
        </table>

        <dl class="image-info" ng:if="image.data.metadata.keywords.length > 0">
            <dt class="image-info__heading">Keywords</dt>
            <dd>
                <ul>
                    <li ng:repeat="keyword in image.data.metadata.keywords"
                        class="image-info__keyword">
                        {{keyword}}
                    </li>
                </ul>
            </dd>
        </dl>

        <dl class="image-info" ng:if="crops.length > 0">
            <dt class="image-info__heading">Crops <span ng:if="cropKey">(<a ui:sref="{ crop: null }">original</a>)</span></dt>
            <dd>
                <ul class="image-crops">
                    <li class="image-crops__crop"
                        ng:class="{'image-crops__crop--selected': (crop|getCropKey) == cropKey}"
                        ng:repeat="crop in crops"
                        ng:init="extremeAssets = (crop | getExtremeAssets)">
                        <a ui:sref="{crop: (crop | getCropKey)}">
                            <img class="image-crops__crop-image"
                                 draggable="true"
                                 ng:src="{{extremeAssets.smallest.file}}"
                                 ui:drag-data="{{image | asImageAndCropsDragData:crop}}"
                                 ui:drag-image="{{extremeAssets.smallest.file}}" />
                        </a>
                    </li>
                </ul>
            </dd>
        </dl>
    </div>

    <div class="easel easel--with-meta" ng:if="! cropKey">
        <div class="easel__canvas">
            <a ui:sref="{}"
               ui:drag-data="{{image | asImageDragData}}">
                <img class="easel__image" ng:src="{{image.data.secureUrl}}"/>
            </a>
        </div>

        <div class="palette">
            <a class="palette__button" ui:sref="search.results">back to search</a>
            <a class="palette__button" ui:sref="crop({imageId: image.data.id})">create crop âœ„</a>
        </div>
    </div>

    <!-- if we want to see a crop -->
    <div class="easel easel--with-meta" ng:if="cropKey">
        <!-- TODO: As this loads async, add a loader -->
        <div class="easel__canvas">
            <a ui:sref="{crop: cropKey}"
               ng:if="crop"
               ng:init="extremeAssets = (crop | getExtremeAssets)">
                <img class="easel__image"
                     draggable="true"
                     ng:src="{{extremeAssets.largest.file}}"
                     ui:drag-data="{{image | asImageAndCropsDragData:crop}}"
                     ui:drag-image="{{extremeAssets.smallest.file}}" />
            </a>
        </div>

        <div class="palette">
            <a class="palette__button" ui:sref="search.results">back to search</a>
            <a class="palette__button" ui:sref="{crop: null}">back to original</a>
        </div>
    </div>
</div>
