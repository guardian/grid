{
    "description": "Simple AMIs for the Grid",

    "builders": [{
        "type": "amazon-ebs",
        "region": "eu-west-1",
        "source_ami": "ami-b17a12c6",
        "instance_type": "t2.micro",
        "ssh_username": "ubuntu",
        "ami_name": "media-service_ebs-storage-cfn_{{timestamp}}",
        "name": "media-service_ebd-storage-cfn_{{timestamp}}",
        "ssh_username": "ubuntu"
    }],

    "provisioners": [{
        "type": "shell",
        "inline": [
            "sudo apt-get -y update",
            "sudo apt-get -y install language-pack-en openjdk-7-jre-headless",

            "# we're adding graphicsmagick to all AMIs so that we will only need",
            "# one provisioner for all our builders",
            "sudo apt-get -y install graphicsmagick graphicsmagick-imagemagick-compat",

            "sudo apt-get -y install python-setuptools",
            "sudo wget -P /root https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
            "sudo mkdir -p /root/aws-cfn-bootstrap-latest",
            "sudo tar xvfz /root/aws-cfn-bootstrap-latest.tar.gz --strip-components=1 -C /root/aws-cfn-bootstrap-latest",

            "# TODO: Remove hack when PBR is ready",
            "# we force the version of PBR here with pip as v0.10.3 breaks",
            "# see: https://forums.aws.amazon.com/thread.jspa?messageID=590567#590567",
            "sudo easy_install pip",
            "sudo pip install pbr==0.10.2",
            "sudo easy_install /root/aws-cfn-bootstrap-latest/"
        ]
    }]
}
